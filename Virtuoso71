FROM centos:6.4
MAINTAINER Francesco Strozzi "https://github.com/fstrozzi"

# Install packages
RUN yum -y install openssh-server autoconf automake libtool flex bison gperf gawk m4 make openssl-devel
RUN ssh-keygen -q -N "" -t dsa -f /etc/ssh/ssh_host_dsa_key && ssh-keygen -q -N "" -t rsa -f /etc/ssh/ssh_host_rsa_key && echo 'root:changeme' | chpasswd
RUN sed -i "s/#UsePrivilegeSeparation.*/UsePrivilegeSeparation no/g" /etc/ssh/sshd_config
RUN sed -i "s/UsePAM.*/UsePAM no/g" /etc/ssh/sshd_config
RUN service sshd start
RUN mkdir -p /usr/local/
RUN cd /usr/local && wget --no-check-certificate https://github.com/openlink/virtuoso-opensource/archive/v7.1.0.tar.gz
RUN cd /usr/local && tar xzvf v7.1.0
RUN cd /usr/local/virtuoso-opensource-7.1.0 && ./autogen.sh && export CFLAGS="-O2 -m64" && ./configure --prefix=/usr/local/virtuoso-opensource-7.1.0 && make && make install
RUN rm /usr/local/v7.1.0

EXPOSE 22 8890
CMD ["/usr/local/virtuoso-opensource-7.1.0/bin/virtuoso-t", "-f","+configfile","/usr/local/virtuoso-opensource-7.1.0/var/lib/virtuoso/db/virtuoso.ini"]
